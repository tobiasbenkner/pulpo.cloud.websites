---
import ProductCard from "./ProductCard.astro";
import { Image } from "astro:assets";
import { imageUrl, type ProductCategory } from "@pulpo/cms";
import punto from "@/assets/punto.webp";

type Props = {
  category: ProductCategory;
};

const { category } = Astro.props;
const categoryId = "ac77db14-3c15-4138-9ba6-e7e089524ac8";
let objectPosition = "center";

if (
  category.image &&
  category.image.focal_point_x &&
  category.image.focal_point_y
) {
  const { width, height, focal_point_x, focal_point_y } = category.image;
  const xPos = (focal_point_x / width!) * 100;
  const yPos = (focal_point_y / height!) * 100;

  objectPosition = `${xPos.toFixed(2)}% ${yPos.toFixed(2)}%`;
}
---

<section id={category.id} class="mb-24" style="scroll-margin-top: 64px;">
  <div class="relative h-64 md:h-96 w-full overflow-hidden rounded-lg mb-12">
    {
      category.image ? (
        <Image
          src={imageUrl((category.image as any).id, 1000)}
          width={1000}
          height={1000}
          alt={String(category.name)}
          class="absolute inset-0 w-full h-full object-cover"
          style={{ objectPosition: objectPosition }}
        />
      ) : (
        <div class="absolute inset-0 bg-card" />
      )
    }

    <div class="absolute inset-0 bg-black/50 flex items-center justify-center">
      <h2
        class="text-4xl md:text-6xl font-extrabold tracking-wider uppercase"
        style={{ textShadow: "2px 2px 8px rgba(0,0,0,0.7)" }}
      >
        {category.name}
      </h2>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-8">
    {category.products.map((product) => <ProductCard product={product} />)}
  </div>

  {
    category.id === categoryId && (
      <>
        <div class="text-center py-4 text-sm">
          * Todas las carnes van acompañadas de guarnición de papas fritas o
          papas panaderas
        </div>
        <div class="mt-8 w-full flex justify-center">
          <Image src={punto} class="w-full max-w-3xl" alt="Punto de la carne" />
        </div>
      </>
    )
  }
</section>
