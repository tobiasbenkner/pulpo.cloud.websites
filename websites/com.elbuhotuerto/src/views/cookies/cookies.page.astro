---
import SectionHeader from "@/components/ui/SectionHeader.astro";
import type { CookiesTranslations } from "./cookies.i18n";
import type { Language } from "@/lib/i18n";

interface Props {
  lang: Language;
  t: CookiesTranslations;
}

const { t } = Astro.props;
---

<div class="bg-background min-h-screen py-32 px-6">
  <div class="max-w-3xl mx-auto">
    <div class="mb-16 text-center">
      <SectionHeader title={t.title} subtitle={t.subtitle} align="center" />
      <p class="text-xs tracking-[0.2em] uppercase text-white/30 mt-8">
        {t.lastUpdate}
      </p>
    </div>

    <article
      class="prose prose-invert prose-lg max-w-none
      prose-headings:font-serif prose-headings:font-normal prose-headings:text-amber-200
      prose-p:text-gray-300 prose-p:leading-relaxed prose-p:font-light
      prose-strong:text-white prose-strong:font-medium"
    >
      <div set:html={t.content} />

      <div
        class="bg-white/5 border border-white/10 rounded-xl p-6 not-prose mt-6"
      >
        <h4 class="text-amber-200 font-serif text-lg mb-2">
          {t.maps.title}
        </h4>
        <p
          id="maps-status-text"
          class="text-sm text-gray-400 mb-4"
          data-active={t.maps.status_active}
          data-inactive={t.maps.status_inactive}
        >
          {t.maps.checking}
        </p>

        <button
          id="revoke-maps-btn"
          class="hidden bg-red-500/10 hover:bg-red-500/20 text-red-400 border border-red-500/50 px-4 py-2 rounded-lg text-sm transition-colors duration-300 flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-4 h-4"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
            ></path>
          </svg>
          {t.maps.revoke_btn}
        </button>

        <div
          id="no-consent-msg"
          class="hidden text-sm text-green-400 flex items-center gap-2"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-4 h-4"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            ></path>
          </svg>
          {t.maps.no_consent}
        </div>
      </div>
    </article>
  </div>
</div>

<script>
  const STORAGE_KEY = "maps-consent";

  const updateCookieUI = () => {
    const btn = document.getElementById("revoke-maps-btn");
    const statusText = document.getElementById("maps-status-text");
    const noConsentMsg = document.getElementById("no-consent-msg");

    if (!btn || !statusText || !noConsentMsg) return;

    const hasConsent = localStorage.getItem(STORAGE_KEY) === "true";
    const activeText = statusText.getAttribute("data-active") || "";
    const inactiveText = statusText.getAttribute("data-inactive") || "";

    if (hasConsent) {
      statusText.innerText = activeText;
      btn.classList.remove("hidden");
      noConsentMsg.classList.add("hidden");
    } else {
      statusText.innerText = inactiveText;
      btn.classList.add("hidden");
      noConsentMsg.classList.remove("hidden");
    }
  };

  const initCookieManager = () => {
    const btn = document.getElementById("revoke-maps-btn");

    if (btn) {
      btn.onclick = () => {
        console.log("Button geklickt - l√∂sche Consent...");
        localStorage.removeItem(STORAGE_KEY);
        updateCookieUI();
      };
    }
    updateCookieUI();
  };

  document.addEventListener("astro:page-load", initCookieManager);
  document.addEventListener("DOMContentLoaded", initCookieManager);
  initCookieManager();
</script>
