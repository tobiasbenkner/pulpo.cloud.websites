---
import Container from "@/components/ui/Container.astro";
import { Icon } from "astro-icon/components";
import type { CookiesTranslations } from "./cookies.i18n";

interface Props {
  t: CookiesTranslations;
}

const { t } = Astro.props;
---

<section class="py-12 md:py-16 lg:py-24">
  <Container>
    <!-- Simple Header -->
    <div class="max-w-3xl mx-auto mb-10 md:mb-12 px-4">
      <span
        class="text-secondary text-xs font-bold uppercase tracking-widest block mb-2"
      >
        {t.header.subtitle}
      </span>
      <h1 class="text-2xl md:text-3xl lg:text-5xl font-serif text-white">
        {t.header.title}
      </h1>
    </div>

    <!-- Content -->
    <div class="prose prose-base md:prose-lg lg:prose-xl prose-invert max-w-3xl mx-auto px-4">
      <h3>{t.content.intro.title}</h3>
      <p>{t.content.intro.text}</p>

      <h3>{t.content.types.title}</h3>
      <p>{t.content.types.text}</p>
      <ul>
        <li>{t.content.types.l1}</li>
        <li>{t.content.types.l2}</li>
      </ul>

      <!-- Maps Management UI -->
      <div
        class="bg-surface border border-border rounded-sm p-6 md:p-8 not-prose mt-10 md:mt-12"
      >
        <h4 class="text-secondary font-serif text-lg md:text-xl mb-3 md:mb-4 font-bold">
          {t.content.maps.title}
        </h4>
        <p class="text-sm md:text-base text-text-muted mb-5 md:mb-6 leading-relaxed">
          {t.content.maps.text}
        </p>

        <p id="maps-status-text" class="text-xs md:text-sm text-text-muted mb-4 font-mono">
          {t.content.maps.status_check}
        </p>

        <!-- Button to revoke -->
        <button
          id="revoke-maps-btn"
          class="hidden bg-red-900/20 hover:bg-red-900/40 text-red-200 border border-red-500/30 px-4 md:px-6 py-2.5 md:py-3 rounded-full text-xs md:text-sm font-bold tracking-wide uppercase transition-colors duration-300 flex items-center gap-2"
        >
          <Icon name="lucide:trash-2" class="w-3 md:w-4 h-3 md:h-4" />
          {t.content.maps.btn_revoke}
        </button>

        <!-- Message if inactive -->
        <div
          id="no-consent-msg"
          class="hidden text-xs md:text-sm text-green-400 flex items-center gap-2 mt-4"
        >
          <Icon name="lucide:check-circle" class="w-3 md:w-4 h-3 md:h-4" />
          {t.content.maps.msg_inactive}
        </div>
      </div>
    </div>
  </Container>
</section>

<!-- Daten fÃ¼r Script bereitstellen -->
<div
  id="i18n-data"
  data-active={t.content.maps.status_active}
  data-inactive={t.content.maps.status_inactive}
  class="hidden"
>
</div>

<script>
  const STORAGE_KEY = "maps-consent";

  const updateCookieUI = () => {
    const btn = document.getElementById("revoke-maps-btn");
    const statusText = document.getElementById("maps-status-text");
    const noConsentMsg = document.getElementById("no-consent-msg");
    const i18nData = document.getElementById("i18n-data");

    if (!btn || !statusText || !noConsentMsg || !i18nData) return;

    const msgActive = i18nData.getAttribute("data-active") || "Active";
    const msgInactive = i18nData.getAttribute("data-inactive") || "Inactive";

    const hasConsent = localStorage.getItem(STORAGE_KEY) === "true";

    if (hasConsent) {
      statusText.innerText = msgActive;
      statusText.classList.add("text-secondary");
      btn.classList.remove("hidden");
      noConsentMsg.classList.add("hidden");
    } else {
      statusText.innerText = msgInactive;
      statusText.classList.remove("text-secondary");
      btn.classList.add("hidden");
      noConsentMsg.classList.remove("hidden");
    }
  };

  const initCookieManager = () => {
    const btn = document.getElementById("revoke-maps-btn");

    if (btn) {
      btn.onclick = () => {
        localStorage.removeItem(STORAGE_KEY);
        updateCookieUI();
      };
    }
    updateCookieUI();
  };

  document.addEventListener("astro:page-load", initCookieManager);
  document.addEventListener("DOMContentLoaded", initCookieManager);
  initCookieManager();
</script>
